<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>Hello OpenCV.js</title>
	<script async src="vendor/opencv.js" onload="console.log('loaded opencv');" type="text/javascript"></script>
	<script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
	<style>
		/*#imageSrc, #outputCanvas {
			max-height: 90vh;
		}*/
	</style>
</head>

<body>
	<h2>Hello OpenCV.js</h2>
	<div>
		<div class="inputoutput">
			<img id="imageSrc" alt="No Image" /><canvas id="outputCanvas"></canvas>
			<div class="caption">imageSrc <input type="file" id="fileInput" name="file" /></div>
		</div>
	</div>
	<script type="text/javascript">
		const SPREAD = 49, SUBTRACT = 49;
		const worker = Tesseract.createWorker({ logger: m => console.log(m) });
		(async () => {
			await worker.load();
			await worker.loadLanguage('eng');
			await worker.initialize('eng');
		})();
		let imgElement = document.getElementById("imageSrc")
		let inputElement = document.getElementById("fileInput");
		let canvas = document.getElementById("outputCanvas");
		inputElement.addEventListener("change", (e) => {
			imgElement.src = URL.createObjectURL(e.target.files[0]);
		}, false);
		let mat;
		imgElement.addEventListener('load', () => {
			mat = cv.imread(imgElement);
			cv.cvtColor(mat, mat, cv.COLOR_BGR2GRAY);
			cv.adaptiveThreshold(mat, mat, 255, cv.ADAPTIVE_THRESH_GAUSSIAN_C, cv.THRESH_BINARY, SPREAD, SUBTRACT);
			cv.imshow("outputCanvas", mat);
		});
		function doit() {
			canvas.toBlob(async blob => {
				let url = URL.createObjectURL(blob);
				const { data: { text } } = await worker.recognize(url);
				console.log(text);
			});
		}
	</script>
</body>

</html>